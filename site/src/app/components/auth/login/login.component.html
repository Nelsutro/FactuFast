<div class="login-page">
  <section class="form-panel">
    <mat-card class="form-card">
      <div class="form-header">
        <span class="brand-pill">
          <mat-icon>bolt</mat-icon>
          FactuFast
        </span>
        <h2>Bienvenido de vuelta</h2>
        <p>Inicia sesión con tus credenciales para continuar gestionando tu facturación.</p>
      </div>

      <div *ngIf="error" class="alert alert-error">
        <mat-icon>error</mat-icon>
        <span>{{ error }}</span>
      </div>

      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Correo electrónico</mat-label>
          <input matInput type="email" formControlName="email" placeholder="tu@email.com">
          <mat-icon matPrefix>email</mat-icon>
          <mat-error *ngIf="loginForm.get('email')?.hasError('required')">
            El correo es requerido
          </mat-error>
          <mat-error *ngIf="loginForm.get('email')?.hasError('email')">
            Formato de correo inválido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>RUT de empresa (opcional)</mat-label>
          <input matInput type="text" formControlName="tax_id" placeholder="12.345.678-9">
          <mat-icon matPrefix>badge</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Contraseña</mat-label>
          <input matInput [type]="showPassword ? 'text' : 'password'" formControlName="password" placeholder="Tu contraseña">
          <mat-icon matPrefix>lock</mat-icon>
          <button mat-icon-button matSuffix type="button" (click)="togglePasswordVisibility()">
            <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="loginForm.get('password')?.hasError('required')">
            La contraseña es requerida
          </mat-error>
          <mat-error *ngIf="loginForm.get('password')?.hasError('minlength')">
            Mínimo 6 caracteres
          </mat-error>
        </mat-form-field>

        <div class="form-actions">
          <mat-checkbox formControlName="rememberMe">Recordarme</mat-checkbox>
          <a href="#" class="link" (click)="goToForgotPassword(); $event.preventDefault()">¿Olvidaste tu contraseña?</a>
        </div>

        <button mat-raised-button color="primary" class="submit-button" type="submit" [disabled]="loginForm.invalid || loading">
          <mat-icon *ngIf="!loading">login</mat-icon>
          <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
          <span>{{ loading ? 'Iniciando sesión...' : 'Iniciar sesión' }}</span>
        </button>
      </form>

      <div class="footer-links">
        <span>¿No tienes una cuenta?</span>
        <a href="#" class="link" (click)="goToRegister(); $event.preventDefault()">Crear acceso</a>
      </div>

      <div class="portal-access">
        <div class="portal-text">¿Necesitas revisar tus facturas como cliente?</div>
        <button mat-stroked-button color="accent" class="portal-button" (click)="goToClientPortal()">
          <mat-icon>open_in_new</mat-icon>
          <span>Ir al portal de clientes</span>
        </button>
      </div>

      <button mat-button color="accent" class="demo-button" (click)="fillDemoCredentials()">
        Rellenar credenciales de demo
      </button>

      <p class="version-text">FactuFast v1.0.0 · © 2025</p>
    </mat-card>
  </section>

  <section class="sso-panel">
    <div class="sso-card">
      <h3>Acceso corporativo</h3>
      <p class="sso-subtitle">Conéctate usando tus credenciales empresariales mediante SSO.</p>

      <div *ngIf="oauthError" class="alert alert-oauth">
        <mat-icon>warning</mat-icon>
        <span>{{ oauthError }}</span>
      </div>

      <div class="sso-grid">
        <button mat-stroked-button class="sso-button google" [disabled]="oauthLoading" (click)="startOAuth('google')">
          <mat-icon>account_circle</mat-icon>
          <span *ngIf="!(oauthLoading && oauthProvider === 'google')">Google Workspace</span>
          <mat-spinner *ngIf="oauthLoading && oauthProvider === 'google'" diameter="18"></mat-spinner>
        </button>

        <button mat-stroked-button class="sso-button microsoft" [disabled]="oauthLoading" (click)="startOAuth('microsoft')">
          <mat-icon>cloud</mat-icon>
          <span *ngIf="!(oauthLoading && oauthProvider === 'microsoft')">Microsoft Entra</span>
          <mat-spinner *ngIf="oauthLoading && oauthProvider === 'microsoft'" diameter="18"></mat-spinner>
        </button>

        <button mat-stroked-button class="sso-button apple" [disabled]="oauthLoading" (click)="startOAuth('apple')">
          <mat-icon>phone_iphone</mat-icon>
          <span *ngIf="!(oauthLoading && oauthProvider === 'apple')">Apple Business</span>
          <mat-spinner *ngIf="oauthLoading && oauthProvider === 'apple'" diameter="18"></mat-spinner>
        </button>
      </div>

      <mat-divider></mat-divider>

      <div class="sso-benefits">
        <div class="benefit-item">
          <mat-icon>verified_user</mat-icon>
          <span>Protocolos seguros con verificación en dos pasos.</span>
        </div>
        <div class="benefit-item">
          <mat-icon>history</mat-icon>
          <span>Historial de accesos centralizado para tu equipo.</span>
        </div>
        <div class="benefit-item">
          <mat-icon>support_agent</mat-icon>
          <span>Soporte preferencial para cuentas corporativas.</span>
        </div>
      </div>
    </div>
  </section>
</div>
