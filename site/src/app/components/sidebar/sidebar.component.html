<div class="sidebar-container" [class.collapsed]="collapsed" aria-label="Barra lateral de navegación">
  <!-- Logo/Header -->
  <div class="sidebar-header">
    <div class="header-left" (click)="$event.stopPropagation()">
      <mat-icon class="logo-icon" aria-hidden="true">bolt</mat-icon>
      <h2 class="logo-text">FactuFast</h2>
    </div>
    <button mat-icon-button class="collapse-btn" (click)="toggleCollapse()" [attr.aria-expanded]="!collapsed" [matTooltip]="collapsed ? 'Expandir' : 'Colapsar'" matTooltipPosition="right">
      <mat-icon>{{ collapsed ? 'chevron_right' : 'chevron_left' }}</mat-icon>
    </button>
  </div>

  <!-- Navigation Menu -->
  <mat-nav-list class="nav-list" role="navigation" aria-label="Navegación principal">
    <div class="section-title" mat-subheader *ngIf="!collapsed">General</div>
    <a mat-list-item 
       routerLink="/dashboard" 
       routerLinkActive="active" #rlaDash="routerLinkActive"
       [routerLinkActiveOptions]="{ exact: true }"
       [attr.aria-current]="rlaDash.isActive ? 'page' : null"
       [matTooltip]="collapsed ? 'Panel de control' : ''"
       matTooltipPosition="right"
       (click)="onItemClick()">
      <mat-icon 
        matListIcon
        [matBadge]="dashboardNotifications > 0 ? dashboardNotifications : null"
        matBadgeColor="warn"
        matBadgeSize="small">
        dashboard
      </mat-icon>
      <span matLine>Dashboard</span>
    </a>

    <div class="section-title" mat-subheader *ngIf="!collapsed">Gestión</div>
    <a mat-list-item 
       routerLink="/invoices" 
       routerLinkActive="active" #rlaInv="routerLinkActive"
       [attr.aria-current]="rlaInv.isActive ? 'page' : null"
     [matTooltip]="collapsed ? 'Gestión de facturas' : ''"
       matTooltipPosition="right"
       (click)="onItemClick()">
      <mat-icon 
        matListIcon
        [matBadge]="pendingInvoices > 0 ? pendingInvoices : null"
        matBadgeColor="accent"
        matBadgeSize="small">
        receipt_long
      </mat-icon>
      <span matLine>Facturas</span>
    </a>

    <a mat-list-item 
       routerLink="/quotes" 
       routerLinkActive="active" #rlaQuo="routerLinkActive"
       [attr.aria-current]="rlaQuo.isActive ? 'page' : null"
     [matTooltip]="collapsed ? 'Cotizaciones y presupuestos' : ''"
       matTooltipPosition="right"
       (click)="onItemClick()">
      <mat-icon 
        matListIcon
        [matBadge]="expiredQuotes > 0 ? expiredQuotes : null"
        matBadgeColor="warn"
        matBadgeSize="small">
        format_quote
      </mat-icon>
      <span matLine>Cotizaciones</span>
    </a>

    <a mat-list-item 
       routerLink="/clients" 
       routerLinkActive="active" #rlaCli="routerLinkActive"
       [attr.aria-current]="rlaCli.isActive ? 'page' : null"
    [matTooltip]="collapsed ? 'Base de datos de clientes' : ''"
       matTooltipPosition="right"
       (click)="onItemClick()">
      <mat-icon matListIcon>people</mat-icon>
      <span matLine>Clientes</span>
      <span class="nav-count" *ngIf="totalClients">{{ totalClients }}</span>
    </a>

    <!-- Companies option - Only visible for admins -->
    <a mat-list-item 
       *ngIf="isAdmin()"
       routerLink="/companies" 
       routerLinkActive="active" #rlaCom="routerLinkActive"
       [attr.aria-current]="rlaCom.isActive ? 'page' : null"
     [matTooltip]="collapsed ? 'Gestión de empresas' : ''"
       matTooltipPosition="right"
       (click)="onItemClick()">
      <mat-icon matListIcon>business</mat-icon>
      <span matLine>Empresas</span>
    </a>

    <div class="section-title" mat-subheader *ngIf="!collapsed">Operación</div>
    <a mat-list-item 
       routerLink="/payments" 
       routerLinkActive="active" #rlaPay="routerLinkActive"
       [attr.aria-current]="rlaPay.isActive ? 'page' : null"
     [matTooltip]="collapsed ? 'Seguimiento de pagos' : ''"
       matTooltipPosition="right"
       (click)="onItemClick()">
      <mat-icon 
        matListIcon
        [matBadge]="overduePayments > 0 ? overduePayments : null"
        matBadgeColor="warn"
        matBadgeSize="small">
        payment
      </mat-icon>
      <span matLine>Pagos</span>
    </a>

    <a mat-list-item 
       routerLink="/automation" 
       routerLinkActive="active" #rlaAut="routerLinkActive"
       [attr.aria-current]="rlaAut.isActive ? 'page' : null"
     [matTooltip]="collapsed ? 'Automatización y programación' : ''"
       matTooltipPosition="right"
       (click)="onItemClick()">
      <mat-icon matListIcon>schedule</mat-icon>
      <span matLine>Automatización</span>
    </a>

    <mat-divider class="nav-divider"></mat-divider>

    <!-- Settings and Support -->
    <div class="section-title" mat-subheader *ngIf="!collapsed">Configuración</div>
    <a mat-list-item 
       routerLink="/settings" 
       routerLinkActive="active" #rlaSet="routerLinkActive"
       [attr.aria-current]="rlaSet.isActive ? 'page' : null"
     [matTooltip]="collapsed ? 'Configuración del sistema' : ''"
       matTooltipPosition="right"
       (click)="onItemClick()">
      <mat-icon matListIcon>settings</mat-icon>
      <span matLine>Configuración</span>
    </a>

    <a mat-list-item 
       routerLink="/help" 
       routerLinkActive="active" #rlaHelp="routerLinkActive"
       [attr.aria-current]="rlaHelp.isActive ? 'page' : null"
     [matTooltip]="collapsed ? 'Ayuda y soporte' : ''"
       matTooltipPosition="right"
       (click)="onItemClick()">
      <mat-icon matListIcon>help</mat-icon>
      <span matLine>Ayuda</span>
    </a>
  </mat-nav-list>

  <!-- Footer Info -->
  <div class="sidebar-footer">
    <mat-divider></mat-divider>
    <div class="version-info">
      <small *ngIf="!collapsed">FactuFast v{{ appVersion }}</small>
    </div>
  </div>
</div>
